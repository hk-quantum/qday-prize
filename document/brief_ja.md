# QDay Prize

## 量子回路の概要

[proos–zalka algorithm](https://arxiv.org/abs/quant-ph/0301141) をベースに以下の量子回路を作成して暗号を解読した。  
ECCのパラメータ $G$ と公開鍵 $Q=dG$ の $Q$ が与えられているため、$aG+bQ$をOracleとするショアのアルゴリズムを利用する。  
Oracleの詳細は[このレポート](https://github.com/hk-quantum/qday-prize/blob/v2.0.0/document/report_ja.md)を参照。

```
       ┌───┐                         ░ ┌──────┐┌─┐   
   qa: ┤ H ├────────■────────────────░─┤ QFT† ├┤M├───
       ├───┤        │                ░ ├──────┤└╥┘┌─┐
   qb: ┤ H ├────────■────────────────░─┤ QFT† ├─╫─┤M├
       └───┘┌───────┴────────┐┌─┐    ░ └──────┘ ║ └╥┘
   qx: ─────┤0               ├┤M├────░──────────╫──╫─
            │                │└╥┘┌─┐ ░          ║  ║ 
   qy: ─────┤1               ├─╫─┤M├─░──────────╫──╫─
            │  oracle: aG+bQ │ ║ └╥┘ ░          ║  ║ 
anc_0: ─────┤2               ├─╫──╫──░──────────╫──╫─
            │                │ ║  ║  ░          ║  ║ 
anc_1: ─────┤3               ├─╫──╫──░──────────╫──╫─
            └────────────────┘ ║  ║  ░          ║  ║ 
  a: 1/════════════════════════╬══╬═════════════╩══╬═
                               ║  ║             0  ║ 
  b: 1/════════════════════════╬══╬════════════════╩═
                               ║  ║                0 
 xy: 2/════════════════════════╩══╩══════════════════
                               0  1                  
```

量子回路の内容。

1. $qa$と$qb$は、それぞれ位数 $n$ のビット数を用意する
2. $qa$ と $qb$ にHゲートを適用して重ね合わせにする
3. $(qx, qy)=aG+bQ$となる量子回路を実行する
4. $(qx, qy)$ を測定して、1つの座標に固定化する
5. $qa$と$qb$にそれぞれ逆量子フーリエ変換（$QFT^†$）を適用する
6. 最後に$qa$と$qb$を測定する

測定した $a$ $b$ の値から以下の手順で秘密鍵を求める。

1. 位数 $n$ のビット数を計算する。
```math
\text{len} = \lfloor \log_2 n \rfloor
```
2. 以下のように $a,b$ の取りうる範囲 $2^{len}$ を $n$ に収めるためスケールした値を $x, y$ に設定する。  
この際、計算誤差も考慮して、切り捨てと切り上げの2つの値を利用する。
```math
x=a \cdot \frac{n}{2^{len}} \mapsto \begin{cases} \text{floor}(a \cdot \frac{n}{2^{len}}) \\ \text{ceil}(a \cdot \frac{n}{2^{len}}) \end{cases} \\
y=b \cdot \frac{n}{2^{len}} \mapsto \begin{cases} \text{floor}(b \cdot \frac{n}{2^{len}}) \\ \text{ceil}(b \cdot \frac{n}{2^{len}}) \end{cases}
```
3. 以下の計算にて秘密鍵を求める。  
$x,y$の切り上げ・切り捨ての組み合わせ4種類で計算して、秘密鍵を満たすかどうかを判定する。
```math
d=x^{-1} \cdot y \mod p
```

シミュレータでの実行により、正解を導くことのできる測定結果を得られる確率は、ECCビット数が小さい場合は60%〜70%程度となるが、位数のビット数が大きくなれば80%以上の確率で正解の測定結果を得られることが分かった。  
なお、量子コンピュータの実機（ibm_torino）では、エラーの影響で正しい計算結果を得られず、測定結果がランダムの場合と同等の正答率となった。

## 必要となるリソース量

本作では、どのようなECCパラメータでも正しく動作するよう汎用的な量子回路で構成していることから、比較的多くの量子ゲートを必要としている。  
今回提示されている[ECC Curves and Keys](https://www.qdayprize.org/curves.txt)に対して、量子回路は深くなるものの量子ビット数を抑えたcompact版と、量子ビット数は増えるものの量子回路を浅くした wide 版を実装している。  
詳細は[このレポート](https://github.com/hk-quantum/qday-prize/blob/v2.0.0/document/report_ja.md)を参照。

今回の量子回路では、ビットコインで採用されている secp256k1 を解読する場合、compact版で12万量子ビット以上、wide版で3000万量子ビット近く必要になる。  
このことから、現段階では量子コンピュータにより解読される可能性は低いと考えられる。
